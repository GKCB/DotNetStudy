# 数据库第一天

## 目录

[数据库的概念](#数据库的概念)  
[数据库的特点](#数据库的特点)  
[数据库的基本组成](#数据库的基本组成)  
[数据库管理](#数据库管理)  
[可视化创建数据库、表、主键](#可视化创建数据库-表-主键)  
[数据库的字段类型详解](#数据库的字段类型详解)  
[案例 创建School数据库](#案例-创建school数据库)  
[数据库的迁移方案](#数据库的迁移方案)  
[SQL脚本](#sql脚本)  
[基本的DDL-SQL脚本](#基本的ddl-sql脚本)  
[基本的DML-SQL脚本](#基本的dmlDML-SQL脚本)  
[案例 OA系统数据库设计](#案例-OA系统数据库设计)  
[约束](#约束)  
[最牛的注释：就是没有注释](#最牛的注释-就是没有注释)  

## 数据库的概念  
- 数据库的概念：数据库就是数据仓库。  
- DBMS:数据库管理系统。`SQLServer`, `Oracle`

返回：[目录](#目录)  

## 数据库的特点  

安全性
并发访问处理
高效率
海量数据存储
数据完整性

要写足够“标准”的数据库编写。考虑将来的迁移。

返回：[目录](#目录)  

## 数据库的基本组成   

数据库本身就是“二维数组”。就像Excel表格那样。
数据库
- 架构（表的分组，多张“表格”）
    - 表
        - 列（Column字段，类型，长度，约束等）
        - 行（Row）
        - 主键：自动增长，GUID
        - 外键

主键（PrimaryKey），就是数据行的唯一标识。这列上面不重复的才能作为主键。为了处理方便，表上面都设置主键。

两种主键：业务主键和逻辑主键。
业务主键：使用有业务意义的作为主键，例如身份证号码，账号。
逻辑主键：没有任何业务意义的字段做主键，给程序用的。

做业务的人不一定能保证业务主键会不会重复，也不能肯定账号会不会升级。推荐使用逻辑主键。

推荐的逻辑主键：  
1、自动逐个增长的数据（例如001,002,003）或者  
2、是GUID（Globally Unique Identifier）当前电脑网卡MAC地址+当前电脑的原子时钟里的时间计算出来  
任何一台电脑在全球任何一个事件算出来的数值都不一样。全球唯一标识。  

表间关联、外键（ForeignKey）：

![ForeignKey](./images/database01/ForeignKey.png)

类似上面表格，讲一张表格拆分成两张表格。表格之间有“厂家编号”来关联。  

返回：[目录](#目录)  

## 数据库管理    

数据库安装
数据库的实例名详解：区分安装在同一台机器上不同的MSSqlServer 服务的。
    
- 混合身份验证：Windows身份验证、SQLServer身份验证  
    - 启用SA账户（安装的时候可以直接设置启用）  
    - 链接数据库：  
        - 保证SQLServer服务器开启  
        - "." 和 （local) 和 机器名一样，代表链接本机。  
        - ip地址：  
            - 回环地址：127.0.0.1  
            - 局域网ip地址，外网ip地址  

![MSSQLSERVER](./images/database01/MSSQLSERVER.png)  

这里看到“实例名”叫MSSQLSERVER。这是默认的“实例名”

![默认实例名](./images/database01/默认实例名.png)  
默认“实例名”."后面可以啥都没有。

但是要是链接别地地方例如，外网服务器：考虑“SQL Server身份验证”实际工作一般都是这类登录。

![SQL-Server身份验证](./images/database01/SQL-Server身份验证.png)    

如果没有选择“混合身份验证”怎么处理：  
1，先用“Windows 身份验证”登录  
2，在“安全”那里找到对应的“sa”用户  
3，修改“sa”用户密码就可以登录了  

返回：[目录](#目录) 

## 可视化创建数据库、表、主键    

链接上数据库服务器之后：1、创建数据库 2、创建表 3、创建列 4、创建主键

1、创建数据库
- 数据库文件默认位置：C:\Program Files\Microsoft SQL Server\MSSQL11.MSSQLSERVER\MSSQL\DATA\
            （创建数据库最好放到此位置，避免权限问题。）

![创建数据库](./images/database01/创建数据库.png) 

2、创建表
&emsp;命名规范同类，表名就是类名。
&emsp;列：
&emsp;&emsp;NChar,Nvarchar(32)      N:Unicode，2个字节表示一个字符。
&emsp;&emsp;Char：一个字节表示一个字符。
&emsp;&emsp;可能遇到的问题：“阻止保存要求重新创建表的更改”的问题，解决办法： 工具→选项→设计器→阻止表的更改
    
&emsp;主键：
电脑上面找到“SQL Server 配置管理器”->“SQL Server 网络配置”
发现三个协议：Shared Memory, Named Pipes（命名管道），TCP/IP 协议（工作中一般用这个）。

返回：[目录](#目录) 

## 数据库的字段类型详解  

image类型：可用来存放图片，图片一般都是单独放文件夹，不太方便放数据库。

设置主键：

![设置主键](./images/database01/设置主键.png)

在相关列那里，右击就会发现如何设置“主键”。

![主键依次递增](./images/database01/主键依次递增.png)

列属性，“标识规范”。那里选择“是”。可以让主键依次递增。

返回：[目录](#目录)  

## 案例 创建School数据库  

大致需求：  
1. 创建一个 School 数据库  
2. 创建一个班级表：  
TblClass: 
tClassId,tClassName, tClassDesc
3. 学生信息表：  
TblStudent: tSId,tSName, tSGender, tSAddress,
tSPhone,tSAge, tSBirthday, tSCardId, tSClassId  
4. 分离数据库,对数据库进行附加  

注意，字符长度要是2的整数幂。例如`nvarchar(32)`  
关于数据的删除，应该都是用`软删除`，也就是表面上看`删除`了。但是事实上，数据库内部还存在。数据只要进了数据库就不会被删除。而为了做这个软删除，需要做一个标志位，常用字段DelFlag。如果数据真的太多了，那就迁移出来进行备份。

![删除标志位DelFlag](./images/database01/删除用的标志位DelFlag.png)

```
nvarchar(n) ：包含 n个字符的可变长度 Unicode 字符数据。n的值必须介于 1  与  4,000 之间。字节的存储大小是所输入字符个数的两倍。所输入的数据字符长度可以为零。
varchar[(n)]：长度为 n 个字节的可变长度且非 Unicode的字符数据。n 必须是一个介于1和8,000之间的数值。存储大小为输入数据的字节的实际长度，而不是 n 个字节。所输入的数据字符长度可以为零。
```  

## 数据库的迁移方案   

### 几种迁移方案:  
这里主数据库名字是`MyFirstDb.mdf`,日志文件是`MyFirstDb_log.ldf`  
以下四种以“生成SQL脚本”最为保险：  
1. [分离,附加](#分离附加)
2. [脱机,附加](#脱机附加)
3. [备份,还原](#备份还原)  
4. [生成SQL脚本](#生成sql脚本)  

#### 分离,附加  
分离操作：  
![分离操作](./images/database01/分离操作.png)

保证数据库无人使用  
![保证数据库无人使用](./images/database01/保证数据库无人使用.png)

分离之后，“数据库”里就不会出现原来的数据库了。

这时候需要进行附加操作：  
![附加操作](./images/database01/附加操作.png)

完成添加操作    
![完成添加操作](./images/database01/完成添加操作.png)

使用分离，附加  方法的注意点
&emsp;权限问题  
&emsp;&emsp;启用Administrator账号  
&emsp;&emsp;把数据库文件放到默认的数据库文件存放目录  
&emsp;&emsp;据库文件兼容级别，设置成2005兼容（“数据库属性”中“选项”中进行设置）  

[几种迁移方案](#几种迁移方案)

#### 脱机,附加
脱机处理，就是指。将原来正在访问的数据库“脱机”了。因为在链接状态下，`mdf` 和 `ldf`文件都不允许轻易的移动。必须先脱机处理。  
在相关数据库，右击选择“任务”选择“脱机”。如果想恢复，就选择“联机”。  

![脱机处理](./images/database01/脱机处理.png)  
和 “分离,附加” 这类方法很接近。    

[几种迁移方案](#几种迁移方案)  

#### 备份,还原  

备份处理，也是在相关数据库中，右击选择“任务”，选择“备份”。会在`Backup`文件夹下面生成 `bak` 文件。

客户在使用的时候，需要先自己手动创建，相同名字的数据库。客户在创建好数据库之后，右击“任务”，选择“还原”中的“文件和文件组”。如果使用“数据库”的话可能会失败。要注意“覆盖现有数据库”

[几种迁移方案](#几种迁移方案)  

#### 生成SQL脚本  

数据库右击，找到“任务”，选择“生成脚本”。

设置脚本编写选项  
![设置脚本编写选项](./images/database01/设置脚本编写选项.png)    

[几种迁移方案](#几种迁移方案)  

返回：[目录](#目录)

## SQL脚本  

SQL 全名是结构化查询语言（```Structured Query Language```），是关系数据库管理系统的标准语言。各类数据库都认。  

SQL 主要分DDL(数据定义语言，建表，建库等语句)、DML(数据操作语言)和DCL(数据库控制语言)。  
Create Table、Drop Table、Alter Table等属于DDL，Select、Insert、Update、Delete等属于DML，GRANT授权、REVOKDE取消授权属于DCL。  

《[DQL、DML、DDL、DCL的概念与区别](https://www.cnblogs.com/fan-yuan/p/7879353.html)》    

脚本：一般就是指比较简单的，不需要编译的可以直接解析执行的语言，常见的有：SQL、JavaScript等。  
&emsp;T-SQL的特点：  
&emsp;&emsp;跨DBMS(Database Management System)，基本上所有的DBMS都对标T-SQL兼容。  
&emsp;&emsp;大小写不敏感(仅仅是关键字不敏感，字符串数据是大小写敏感的)    
&emsp;&emsp;转义  

返回：[目录](#目录)  

## 基本的DDL-SQL脚本  

```{.line-numbers}  
数据定义语言DDL（ Data definition language ）:是SQL语言的一个分类，用于对数据库对象（表、视图、序列等）进行创建、修改、删除等操作。
通过以下几个关键字实现：
CREATE（新建）、 ALTER（修改） DROP（删除） RENAME（重命名） TRUNCATE（截断）
```  

- 创建数据库(Create Databas)：  
- 创建表(包括主键、自动增长、是否可空)等：  

创建数据库(Create Databas)：  
点击“新建查询”，创建新的sql脚本语言。
![创建数据库DDL-SQL脚本](./images/database01/创建数据库DDL-SQL脚本.png)  

新脚本保存的时候别忘了看看保存的位置，保存成功之后点击“执行(F5)”自然就可以生成对应的数据库。  
![DDL-SQL脚本生成对应的数据库](./images/database01/DDL-SQL脚本生成对应的数据库.png)  

SQL脚本创建表：  
![选中的数据库中创建表](./images/database01/选中的数据库中创建表.png)  


```sql{.line-numbers}  
-- 自动增长的主键
use PhpDb
go
create table Test2
(
	Id int identity(1,1) primary key not null,
	Name nvarchar(32) null
)
go
```


```
--基本查询

```
返回：[目录](#目录)  


## 基本的DML-SQL脚本  

## 案例 OA系统数据库设计    
## 约束    

## 最牛的注释：就是没有注释  
